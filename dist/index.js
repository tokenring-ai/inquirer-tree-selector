import{createPrompt as e,useState as t,makeTheme as l,usePrefix as n,useEffect as i,useKeypress as r,isEnterKey as s,isSpaceKey as c,isUpKey as a,isDownKey as o,usePagination as m}from"@inquirer/core";import h from"@inquirer/figures";import u from"chalk";const d={Idle:"idle",Done:"done",Canceled:"canceled"},p={prefix:{idle:u.cyan("?"),done:u.green(h.tick),canceled:u.red(h.cross)},style:{active:e=>u.cyan(e),selected:e=>u.green(`${e} ${h.tick}`),unselected:e=>e,cancelText:e=>u.red(e),emptyText:e=>u.red(e),group:e=>u.yellowBright(e),item:e=>e,message:(e,t)=>u.bold(e),help:e=>u.italic.gray(e),answer:e=>u.cyan(e)},hierarchySymbols:{branch:h.lineUpDownRight+h.line,leaf:h.lineUpRight+h.line},help:{top:(e,t)=>`(Press ${h.arrowUp+h.arrowDown} to navigate, ${h.arrowLeft+h.arrowRight} to navigate tree${t?", <space> to toggle selection":""}, <enter> to ${t?"confirm":"select"}${e?", <esc> or q to cancel":""})`,item:e=>e?"(Press <space> to toggle selection)":"(Press <enter> to select)"},renderItem(e,t){const l=t.index===t.items.length-1;let n=l&&!t.loop?this.hierarchySymbols.leaf:this.hierarchySymbols.branch;if(t.isSelected?n+=this.style.selected(e.name):(t.isActive?n+=this.style.active(e.name):t.isSelected?n+=this.style.selected(e.name):e.children?n+=this.style.group(e.name):(l&&t.loop,n+=this.style.unselected(e.name)),n+="  "),t.isActive){const e=this.help.item(t.multiple);n+=` ${this.style.help(e)}`}return n}};function f(e){return"pageup"===e.name}function g(h){return e((e,h)=>{const{pageSize:u=10,loop:g=!1,allowCancel:y=!1,cancelText:$="Canceled.",emptyText:v="No items available.",multiple:x=!1,initialSelection:w,tree:S}=e,[b,D]=t(d.Idle),T=l(p,e.theme),A=n({status:b,theme:T}),[C,I]=t(Array.isArray(w)?w:[w]),[k,q]=t([S]),P=k[k.length-1],[L,R]=t();i(()=>{P.children instanceof Function?(R(void 0),Promise.resolve(P.children()).then(e=>R(e??[]))):process.nextTick(()=>R(P.children??[]))},[P,P?.children]);const[U,z]=t(0),M=null!=L?L[U]:void 0;r((e,t)=>{if(s(e))if(x)D(d.Done),h(C);else{if(null==M?.value)return;D(d.Done),h(M.value)}else if(c(e)){if(null==M?.value)return;if(x){const e=C.indexOf(M.value);I(-1!==e?[...C.slice(0,e),...C.slice(e+1)]:[...C,M.value])}else D(d.Done),h(M.value)}else if(function(e){return"right"===e.name}(e))M?.children&&q([...k,M]);else if(function(e){return"left"===e.name}(e)&&k.length>1)q(k.slice(0,-1));else if(function(e){return"escape"===e.name||"q"===e.name}(e)&&y)D(d.Canceled),h(null);else if(a(e)||o(e)||f(e)||function(e){return"pagedown"===e.name}(e)){t.clearLine(0);let l=a(e)?U-1:o(e)?U+1:f(e)?U-u:U+u;l=g?L?.length??0%l:Math.min(Math.max(l,0),(L?.length??0)-1),z(l)}});const B=m({items:L??[],active:U,renderItem:({item:e,index:t,isActive:l})=>T.renderItem(e,{items:L??[],loop:g,index:t,isActive:l,isSelected:null!=e.value&&C.includes(e.value),multiple:x}),pageSize:u,loop:g}),F=T.style.message(e.message,b);if(b===d.Canceled)return`${A} ${F} ${T.style.cancelText($)}`;if(M&&b===d.Done){if(x){const e=C.length,t=1===e?"item":"items";return`${A} ${F} ${T.style.answer(`${e} ${t} selected`)}`}return`${A} ${F} ${T.style.answer(M.name)}`}return`${A} ${F} ${T.style.help(T.help.top(y,x))}\n${null==L?"Loading...":B.length?B:T.style.emptyText(v)}[?25l`})(h)}export{d as Status,g as treeSelector};

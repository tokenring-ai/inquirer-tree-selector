import{createPrompt as e,useState as t,makeTheme as n,usePrefix as l,useEffect as i,useKeypress as r,isEnterKey as s,isSpaceKey as c,isUpKey as o,isDownKey as a,usePagination as h}from"@inquirer/core";import m from"@inquirer/figures";import u from"chalk";const d={Idle:"idle",Done:"done",Canceled:"canceled"},p={prefix:{idle:u.cyan("?"),done:u.green(m.tick),canceled:u.red(m.cross)},style:{active:e=>u.cyan(e),selected:e=>u.green(`${e} ${m.tick}`),unselected:e=>e,cancelText:e=>u.red(e),emptyText:e=>u.red(e),group:e=>u.yellowBright(e),item:e=>e,message:(e,t)=>u.bold(e),help:e=>u.italic.gray(e),answer:e=>u.cyan(e)},hierarchySymbols:{branch:m.lineUpDownRight+m.line,leaf:m.lineUpRight+m.line},help:{top:(e,t)=>`(Press ${m.arrowUp+m.arrowDown} to navigate, ${m.arrowLeft+m.arrowRight} to navigate tree${t?", <space> to toggle selection":""}, <enter> to ${t?"confirm":"select"}${e?", <esc> or q to cancel":""})`,item:e=>e?"(Press <space> to toggle selection)":"(Press <enter> to select)"},renderItem(e,t){const n=t.index===t.items.length-1;let l=n&&!t.loop?this.hierarchySymbols.leaf:this.hierarchySymbols.branch;if(t.isSelected?l+=this.style.selected(e.name):(t.isActive?l+=this.style.active(e.name):t.isSelected?l+=this.style.selected(e.name):e.children?l+=this.style.group(e.name):(n&&t.loop,l+=this.style.unselected(e.name)),l+="  "),t.isActive){const e=this.help.item(t.multiple);l+=` ${this.style.help(e)}`}return l}};function g(e){return"pageup"===e.name}function f(m){return e((e,m)=>{const{pageSize:u=10,loop:f=!1,allowCancel:y=!1,cancelText:$="Canceled.",emptyText:v="No items available.",multiple:x=!1,initialSelection:w=[],tree:S}=e,[b,D]=t(d.Idle),T=n(p,e.theme),A=l({status:b,theme:T}),[C,I]=t(Array.isArray(w)?w:[w]),[k,q]=t([S]),[P,L]=t([0]),R=k[k.length-1],[U,z]=t();i(()=>{R.children instanceof Function?(z(void 0),Promise.resolve(R.children()).then(e=>z(e??[]))):process.nextTick(()=>z(R.children??[]))},[R,R?.children]);const[M,B]=t(0),F=null!=U?U[M]:void 0;r((e,t)=>{if(s(e))if(x)D(d.Done),m(C);else{if(null==F?.value)return void(F?.children&&(q([...k,F]),L([...P,0]),B(0)));D(d.Done),m(F.value)}else if(c(e)){if(null==F?.value)return;if(x){const e=C.indexOf(F.value);I(-1!==e?[...C.slice(0,e),...C.slice(e+1)]:[...C,F.value])}else D(d.Done),m(F.value)}else if(function(e){return"right"===e.name}(e))F?.children&&(q([...k,F]),L([...P,0]),B(0));else if(function(e){return"left"===e.name}(e)&&k.length>1){const e=P.slice(0,-1);q(k.slice(0,-1)),L(e),B(e[e.length-1])}else if(function(e){return"escape"===e.name||"q"===e.name}(e)&&y)D(d.Canceled),m(null);else if(o(e)||a(e)||g(e)||function(e){return"pagedown"===e.name}(e)){t.clearLine(0);let n=o(e)?M-1:a(e)?M+1:g(e)?M-u:M+u;n=f?U?.length??0%n:Math.min(Math.max(n,0),(U?.length??0)-1),B(n);const l=[...P];l[l.length-1]=n,L(l)}});const N=h({items:U??[],active:M,renderItem:({item:e,index:t,isActive:n})=>T.renderItem(e,{items:U??[],loop:f,index:t,isActive:n,isSelected:null!=e.value&&C.includes(e.value),multiple:x}),pageSize:u,loop:f}),O=T.style.message(e.message,b);if(b===d.Canceled)return`${A} ${O} ${T.style.cancelText($)}`;if(F&&b===d.Done){if(x){const e=C.length,t=1===e?"item":"items";return`${A} ${O} ${T.style.answer(`${e} ${t} selected`)}`}return`${A} ${O} ${T.style.answer(F.name)}`}return`${A} ${O} ${T.style.help(T.help.top(y,x))}\n${null==U?"Loading...":N.length?N:T.style.emptyText(v)}[?25l`})(m)}export{d as Status,f as treeSelector};
